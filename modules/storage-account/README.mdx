---
title: 'README'
description: 'Quick overview of module usage, inputs, outputs and requirements.'
icon: 'circle-info'
---

## 1. Module
Terraform module to create an Azure Storage Account with optional per-service Private Endpoints and integrated monitoring alerts.

## 2. Usage
```hcl
module "region_abbreviations" {
  source = "../region-abbreviations"
}

module "storage_account" {
  source = "../storage-account"

  environment          = "dev"
  service_prefix       = "acme"
  resource_group_name  = "rg-platform-dev"
  location             = "westeurope"
  region_abbreviations = module.region_abbreviations.regions

  account_tier             = "Standard"
  account_replication_type = "LRS"
  account_kind             = "StorageV2"
  access_tier              = "Hot"

  public_network_access_enabled     = false
  shared_access_key_enabled         = true
  infrastructure_encryption_enabled = false

  # Network Rules
  network_rules_default_action = "Deny"
  network_rules_bypass         = ["AzureServices"]

  # Private Endpoints (optional)
  enable_private_endpoint_blob  = true
  enable_private_endpoint_file  = false
  enable_private_endpoint_queue = false
  enable_private_endpoint_table = false
  enable_private_endpoint_dfs   = false

  dns_resource_group_name   = "rg-network-dev"
  subnet_id                 = "/subscriptions/xxx/resourceGroups/rg-network-dev/providers/Microsoft.Network/virtualNetworks/vnet-dev/subnets/snet-privates"
  private_endpoint_location = "westeurope"

  # Alerts
  enable_availability_alert = true
  enable_success_server_latency_alert = true
  enable_used_capacity_alert = true

  # Optional alert overrides (examples)
  availability_alert_severity = 1
  success_server_latency_alert_threshold = 500
  used_capacity_alert_threshold = 1e+15
  availability_alert_action_group_ids = [module.action_group.action_group_id]
  success_server_latency_alert_action_group_ids = [module.action_group.action_group_id]
  used_capacity_alert_action_group_ids = [module.action_group.action_group_id]

  tags = {
    environment = "dev"
    project     = "acme"
  }
}
```

## 3. Alerts

The module includes integrated monitoring alerts for Storage Account metrics:

### Availability
- Metric: `Availability`
- Namespace: `Microsoft.Storage/storageAccounts`
- Aggregation: `Average`
- Operator: `LessThan`
- Frequency (default): `PT1M`
- Window (default): `PT1M`
- Severity (default): `1`
- Threshold (default): `100` %
- Name (default): `alrt-avail-<resource-name>`
- Enabled (default): `true`

### Success Server Latency
- Metric: `SuccessServerLatency`
- Namespace: `Microsoft.Storage/storageAccounts`
- Aggregation: `Average`
- Operator: `GreaterThan`
- Frequency (default): `PT1M`
- Window (default): `PT5M`
- Severity (default): `2`
- Threshold (default): `1000` ms
- Name (default): `alrt-sslat-<resource-name>`
- Enabled (default): `true`

### Used Capacity
- Metric: `UsedCapacity`
- Namespace: `Microsoft.Storage/storageAccounts`
- Aggregation: `Average`
- Operator: `GreaterThan`
- Frequency (default): `PT1H`
- Window (default): `PT1H`
- Severity (default): `3`
- Threshold (default): `5e+14` bytes
- Name (default): `alrt-used-<resource-name>`
- Enabled (default): `true`

## 4. Inputs
| Name | Type | Default | Required | Description |
|------|------|---------|:--------:|-------------|
| `environment` | `string` | n/a | yes | Environment project (dev, qua or prd). |
| `service_prefix` | `string` | n/a | yes | Prefix or name of the project. |
| `location` | `string` | n/a | yes | Azure region. |
| `resource_group_name` | `string` | n/a | yes | Resource group in which to create the Storage Account. |
| `region_abbreviations` | `map(string)` | n/a | yes | Map of Azure locations to abbreviations. |
| `account_tier` | `string` | `"Standard"` | no | Storage account tier. |
| `account_replication_type` | `string` | `"LRS"` | no | Replication type. |
| `account_kind` | `string` | `"StorageV2"` | no | Account kind. |
| `access_tier` | `string` | `"Hot"` | no | Access tier. |
| `min_tls_version` | `string` | `"TLS1_2"` | no | Minimum TLS version. |
| `public_network_access_enabled` | `bool` | `false` | no | Allow public network access. |
| `shared_access_key_enabled` | `bool` | `true` | no | Enable shared access keys. |
| `infrastructure_encryption_enabled` | `bool` | `false` | no | Enable infrastructure encryption. |
| `network_rules_default_action` | `string` | `"Deny"` | no | Default network action (`Allow`, `Deny`). |
| `network_rules_bypass` | `list(string)` | `["AzureServices"]` | no | Services that can bypass storage network rules (`AzureServices`, `Logging`, `Metrics`). |
| `enable_private_endpoint_*` | `bool` | varies | no | Enable per-service Private Endpoints. |
| `dns_resource_group_name` | `string` | `""` | no | RG with Private DNS Zones for storage. |
| `subnet_id` | `string` | `""` | no | Subnet ID for the Private Endpoints. |
| `private_endpoint_location` | `string` | `""` | no | Location for the Private Endpoints. |
| `tags` | `map(string)` | `{}` | no | Tags to apply to resources. |
| `identity` | `object` | `{ type = "SystemAssigned" }` | no | Managed identity configuration. |

## 4. Outputs
| Name | Description |
|------|-------------|
| `storage_account_id` | Resource ID of the Storage Account. |
| `storage_account_name` | Name of the Storage Account. |
| `storage_account_primary_access_key` | Primary access key for the Storage Account. |
| `storage_account_primary_blob_endpoint` | Primary Blob service endpoint for the Storage Account. |
| `private_endpoint_blob_id` | The ID of the Blob private endpoint if created, otherwise null. |
| `private_endpoint_file_id` | The ID of the File private endpoint if created, otherwise null. |
| `availability_alert_id` | Resource ID of the availability metric alert (null if disabled). |
| `availability_alert_name` | Name of the availability metric alert (null if disabled). |
| `success_server_latency_alert_id` | Resource ID of the success server latency metric alert (null if disabled). |
| `success_server_latency_alert_name` | Name of the success server latency metric alert (null if disabled). |
| `used_capacity_alert_id` | Resource ID of the used capacity metric alert (null if disabled). |
| `used_capacity_alert_name` | Name of the used capacity metric alert (null if disabled). |

## 5. Requirements
- Terraform `>= 1.12.1`
- AzureRM provider `>= 4.38.1`
- Existing Resource Group


