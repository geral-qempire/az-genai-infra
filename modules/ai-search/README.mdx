---
title: 'README'
description: 'Quick overview of module usage, inputs, outputs and requirements.'
icon: 'server'
---

## 1. Module
Create an Azure AI Search service with configurable authentication (RBAC, API keys, or both), optional Private Endpoint, and managed identity.

## 2. Usage
```hcl
module "region_abbreviations" {
  source = "../region-abbreviations"
}

module "ai_search" {
  source = "../ai-search"

  environment          = "dev"
  service_prefix       = "acme"
  resource_group_name  = "rg-platform-dev"
  location             = "westeurope"
  region_abbreviations = module.region_abbreviations.regions

  api_access = "RBAC"

  sku                           = "standard"
  partition_count               = 1
  replica_count                 = 1
  semantic_search_sku           = "standard"
  hosting_mode                  = "default"
  public_network_access_enabled = false

  # Network rules
  network_rule_bypass_option = "None" # or "AzureServices"

  # Private Endpoint (optional)
  enable_private_endpoint   = true
  dns_resource_group_name   = "rg-network-dev"
  subnet_id                 = "/subscriptions/xxx/resourceGroups/rg-network-dev/providers/Microsoft.Network/virtualNetworks/vnet-dev/subnets/snet-privates"
  private_endpoint_location = "westeurope"

  # Alerts
  enable_search_latency_alert       = true
  enable_throttled_search_pct_alert = true

  # Optional overrides (examples)
  search_latency_alert_severity                  = 2
  search_latency_alert_frequency                 = "PT2M"
  throttled_search_pct_alert_threshold           = 15
  throttled_search_pct_alert_action_group_ids    = [module.action_group.action_group_id]
  search_latency_alert_action_group_ids          = [module.action_group.action_group_id]

  tags = {
    environment = "dev"
    project     = "acme"
  }
}
```

## 3. Alerts

### SearchLatency
  - Metric: `SearchLatency`
  - Namespace: `Microsoft.Search/searchServices`
  - Aggregation: `Average`
  - Operator: `GreaterThan`
  - Frequency (default): `PT1M`
  - Window (default): `PT5M`
  - Severity (default): `3`
  - Threshold (default): `5` ms
  - Name (default): `alrt-lat-<resource-name>`
  - Enabled (default): `false`
  
### ThrottledSearchQueriesPercentage
  - Metric: `ThrottledSearchQueriesPercentage`
  - Namespace: `Microsoft.Search/searchServices`
  - Aggregation: `Average`
  - Operator: `GreaterThan`
  - Frequency (default): `PT1M`
  - Window (default): `PT5M`
  - Severity (default): `3`
  - Threshold (default): `10` %
  - Name (default): `alrt-thrpct-<resource-name>`
  - Enabled (default): `false`

## 4. Inputs
| Name | Type | Default | Required | Description |
|------|------|---------|:--------:|-------------|
| `environment` | `string` | n/a | yes | Environment project (dev, qua or prd). |
| `service_prefix` | `string` | n/a | yes | Prefix or name of the project. |
| `location` | `string` | n/a | yes | Azure region. |
| `resource_group_name` | `string` | n/a | yes | Resource group in which to create the Search Service. |
| `region_abbreviations` | `map(string)` | n/a | yes | Map of Azure locations to abbreviations. |
| `sku` | `string` | `"basic"` | no | Search Service SKU. |
| `partition_count` | `number` | `1` | no | Number of partitions (not allowed for `free` SKU). |
| `replica_count` | `number` | `0` | no | Number of replicas. |
| `semantic_search_sku` | `string` | `"free"` | no | Semantic search SKU (`free`, `standard`). |
| `hosting_mode` | `string` | `"default"` | no | Hosting mode (`default`, `highDensity`). |
| `api_access` | `string` | `"RBAC"` | no | Controls how the service is accessed: `RBAC` (Azure AD only), `API` (API keys), or `Both` (AAD + API keys). |
| `public_network_access_enabled` | `bool` | `false` | no | Allow public network access. |
| `network_rule_bypass_option` | `string` | `"None"` | no | Traffic that can bypass network rules (`None`, `AzureServices`). |
| `identity` | `object` | `{ type = "SystemAssigned" }` | no | Managed identity configuration. |
| `enable_private_endpoint` | `bool` | `true` | no | Create a Private Endpoint. |
| `dns_resource_group_name` | `string` | `""` | no | RG with Private DNS Zone `privatelink.search.windows.net`. |
| `subnet_id` | `string` | `""` | no | Subnet ID for the Private Endpoint. |
| `private_endpoint_location` | `string` | `""` | no | Location for the Private Endpoint. |
| `tags` | `map(string)` | `{}` | no | Tags to apply to resources. |
| `enable_search_latency_alert` | `bool` | `false` | no | Enable the SearchLatency metric alert. |
| `search_latency_alert_name` | `string` | `null` | no | Custom name for the SearchLatency alert. Defaults to `alrt-lat-<resource-name>`. |
| `search_latency_alert_threshold` | `number` | `5` | no | Latency threshold in milliseconds. Fires when Average over window exceeds this value. |
| `search_latency_alert_description` | `string` | `null` | no | Description for the SearchLatency alert. Auto-generated if not provided. |
| `search_latency_alert_severity` | `number` | `3` | no | Alert severity (0-4). |
| `search_latency_alert_enabled` | `bool` | `true` | no | Whether the SearchLatency alert is enabled. |
| `search_latency_alert_auto_mitigate` | `bool` | `true` | no | Whether the alert should auto mitigate when conditions clear. |
| `search_latency_alert_frequency` | `string` | `"PT1M"` | no | Evaluation frequency for the SearchLatency alert. |
| `search_latency_alert_window_size` | `string` | `"PT5M"` | no | Time window for the SearchLatency alert. |
| `search_latency_alert_operator` | `string` | `"GreaterThan"` | no | Operator for the SearchLatency alert criteria. |
| `search_latency_alert_aggregation` | `string` | `"Average"` | no | Aggregation for the SearchLatency alert criteria. |
| `search_latency_alert_action_group_ids` | `list(string)` | `[]` | no | Action Group IDs to notify for the SearchLatency alert. |
| `enable_throttled_search_pct_alert` | `bool` | `false` | no | Enable the ThrottledSearchQueriesPercentage metric alert. |
| `throttled_search_pct_alert_name` | `string` | `null` | no | Custom name for the ThrottledSearchQueriesPercentage alert. Defaults to `alrt-thrpct-<resource-name>`. |
| `throttled_search_pct_alert_threshold` | `number` | `10` | no | Percentage threshold. Fires when Average over window exceeds this value. |
| `throttled_search_pct_alert_description` | `string` | `null` | no | Description for the ThrottledSearchQueriesPercentage alert. Auto-generated if not provided. |
| `throttled_search_pct_alert_severity` | `number` | `3` | no | Alert severity (0-4). |
| `throttled_search_pct_alert_enabled` | `bool` | `true` | no | Whether the ThrottledSearchQueriesPercentage alert is enabled. |
| `throttled_search_pct_alert_auto_mitigate` | `bool` | `true` | no | Whether the alert should auto mitigate when conditions clear. |
| `throttled_search_pct_alert_frequency` | `string` | `"PT1M"` | no | Evaluation frequency for the ThrottledSearchQueriesPercentage alert. |
| `throttled_search_pct_alert_window_size` | `string` | `"PT5M"` | no | Time window for the ThrottledSearchQueriesPercentage alert. |
| `throttled_search_pct_alert_operator` | `string` | `"GreaterThan"` | no | Operator for the ThrottledSearchQueriesPercentage alert criteria. |
| `throttled_search_pct_alert_aggregation` | `string` | `"Average"` | no | Aggregation for the ThrottledSearchQueriesPercentage alert criteria. |
| `throttled_search_pct_alert_action_group_ids` | `list(string)` | `[]` | no | Action Group IDs to notify for the ThrottledSearchQueriesPercentage alert. |

## 5. Outputs
| Name | Description |
|------|-------------|
| `search_service_id` | Resource ID of the Search Service. |
| `search_service_name` | Name of the Search Service. |
| `search_service_primary_key` | Primary admin key for the Search Service. |
| `private_endpoint_id` | The ID of the Private Endpoint if created, otherwise `null`. |
| `managed_identity_principal_id` | Principal ID of the system-assigned managed identity. |
| `search_latency_alert_id` | Resource ID of the SearchLatency metric alert (null if disabled). |
| `search_latency_alert_name` | Name of the SearchLatency metric alert (null if disabled). |
| `throttled_search_pct_alert_id` | Resource ID of the ThrottledSearchQueriesPercentage metric alert (null if disabled). |
| `throttled_search_pct_alert_name` | Name of the ThrottledSearchQueriesPercentage metric alert (null if disabled). |

## 6. Requirements
- Terraform `>= 1.12.1, < 2.0.0`
- AzureRM provider `~> 4.38`


