---
title: 'README'
description: 'An overview of requirements, inputs, outputs, and usage.'
icon: 'circle-info'
---

## 1. Template

Provision a secure core framework for GenAI workloads with private networking, alarmistic and RBAC for User groups, Managed identities and Service Principals.

## 2. Usage
```hcl
module "framework-core" {
  source = "../../../templates/framework-core"

  providers = {
    azurerm     = azurerm
    azurerm.dns = azurerm.dns
  }

  # Context
  service_prefix = "chatbot"
  location       = "westeurope"
  tenant_id      = "00000000-0000-0000-0000-000000000000"
  environment    = "dev"
  tags           = { env = "dev", owner = "ai-platform", costcenter = "CC1234" }

  # Networking for Private Endpoints
  subnet_name              = "snet-priv-endpoints"
  vnet_name                = "vnet-hub"
  vnet_resource_group_name = "rg-we-platform-networking"
  dns_resource_group_name  = "rg-we-platform-networking"

  # Observability
  log_analytics_workspace_name                = "law-core-we"
  log_analytics_workspace_resource_group_name = "rg-we-platform-observability"

  # SQL Server (required)
  serial_number                = "001"
  administrator_login          = "sqladminuser"
  administrator_login_password = "ChangeM3Now!"
  entra_admin_login_name       = "ai-sql-admins@contoso.com"
  entra_admin_object_id        = "11111111-1111-1111-1111-111111111111"

  # SQL Database
  sql_database_name                        = "sqldb-chatbot"
  sql_database_sku_name                    = "S0"
  sql_database_min_capacity                = null
  sql_database_auto_pause_delay_in_minutes = null
  sql_database_zone_redundant              = false
  sql_database_backup_interval_in_hours    = 0
  sql_database_pitr_days                   = 7
  sql_database_weekly_ltr_weeks            = 0
  sql_database_monthly_ltr_months          = 0
  sql_database_yearly_ltr_years            = 0

  # Storage Account
  storage_account_account_tier             = "Standard"
  storage_account_account_replication_type = "LRS"
  storage_account_account_kind             = "StorageV2"
  storage_account_access_tier              = "Hot"

  # Key Vault
  key_vault_sku_name                   = "standard"
  key_vault_soft_delete_retention_days = 90
  key_vault_purge_protection_enabled   = true

  # AI Search
  ai_search_sku                 = "basic"
  ai_search_semantic_search_sku = "free"
  ai_search_replica_count       = 1
  ai_search_partition_count     = 1

  # AI Services
  ai_services_sku_name                   = "S0"
  ai_services_soft_delete_retention_days = 0
  ai_services_purge_protection_enabled   = false
  ai_services_model_deployment_names     = ["gpt-4o-mini", "text-embedding-3-large"]

  # Alerts toggles - SQL Database
  sql_db_alert_availability_enabled            = false
  sql_db_alert_app_cpu_percent_enabled         = false
  sql_db_alert_app_memory_percent_enabled      = false
  sql_db_alert_instance_cpu_percent_enabled    = false
  sql_db_alert_instance_memory_percent_enabled = false
  sql_db_alert_storage_percent_enabled         = false

  # Alerts toggles - Storage Account
  storage_alert_availability_enabled           = false
  storage_alert_success_server_latency_enabled = false
  storage_alert_used_capacity_enabled          = false

  # Alerts toggles - Key Vault
  key_vault_alert_availability_enabled       = false
  key_vault_alert_saturation_shoebox_enabled = false

  # Alerts toggles - AI Search
  ai_search_alert_search_latency_enabled = false
  ai_search_alert_throttled_pct_enabled  = false

  # Alerts toggles - AI Services
  ai_services_alert_availability_rate_enabled = false
  ai_services_alert_normalized_ttft_enabled   = false
  ai_services_alert_ttlt_enabled              = false
  ai_services_alert_processed_tokens_enabled  = false

  # RBAC - AD Groups (optional)
  ad_read_group_id = "22222222-2222-2222-2222-222222222222"
  ad_full_group_id = "33333333-3333-3333-3333-333333333333"

  # RBAC - Service Principals (optional)
  sp_cicd_id = "44444444-4444-4444-4444-444444444444"
  sp_app_id  = "55555555-5555-5555-5555-555555555555"

  # Alerts - Action Group
  action_group_emails = ["alerts@contoso.com", "devops@contoso.com"]
}
```

## 3. Inputs
| Name | Type | Default | Required | Description |
|------|------|---------|:--------:|-------------|
| `service_prefix` | `string` | n/a | yes | Prefix or name of the project. |
| `location` | `string` | n/a | yes | Azure region for the deployment. |
| `tenant_id` | `string` | n/a | yes | Azure tenant ID. |
| `subnet_name` | `string` | n/a | yes | Subnet name for private endpoints. |
| `vnet_name` | `string` | n/a | yes | Virtual network name containing the subnet. |
| `vnet_resource_group_name` | `string` | n/a | yes | Resource group name that contains the VNet. |
| `dns_resource_group_name` | `string` | n/a | yes | Resource group with Private DNS zones and VNet/subnet. |
| `log_analytics_workspace_name` | `string` | n/a | yes | Existing Log Analytics Workspace name. |
| `log_analytics_workspace_resource_group_name` | `string` | n/a | yes | Resource group of the existing Log Analytics Workspace. |
| `environment` | `string` | `"dev"` | no | Environment label used by modules and naming. |
| `serial_number` | `string` | n/a | yes | Serial suffix for the SQL Server name. |
| `administrator_login` | `string` | n/a | yes | SQL administrator login for the server. |
| `administrator_login_password` | `string` | n/a | yes | SQL administrator password for the server. |
| `entra_admin_object_id` | `string` | n/a | yes | Object ID (User/Group/SP) for Microsoft Entra administrator. |
| `entra_admin_login_name` | `string` | n/a | yes | Display name (or UPN) of the Entra admin group/user. |
| `sql_database_name` | `string` | n/a | yes | SQL Database name. |
| `sql_database_sku_name` | `string` | `"S0"` | no | SQL Database SKU (e.g., GP_S_Gen5_2, S0, P1). |
| `sql_database_min_capacity` | `number` | `null` | no | Minimum capacity for serverless SKUs. Null to omit. |
| `sql_database_auto_pause_delay_in_minutes` | `number` | `null` | no | Auto-pause delay (minutes) for Serverless SQL Database SKUs. Null to omit. |
| `sql_database_zone_redundant` | `bool` | `false` | no | Enable zone redundancy for SQL Database. |
| `sql_database_backup_interval_in_hours` | `number` | `0` | no | Differential backup interval (0 to omit). |
| `sql_database_pitr_days` | `number` | `7` | no | Point-in-time restore retention days (PITR). |
| `sql_database_weekly_ltr_weeks` | `number` | `0` | no | Weekly LTR retention (weeks). 0 to disable. |
| `sql_database_monthly_ltr_months` | `number` | `0` | no | Monthly LTR retention (months). 0 to disable. |
| `sql_database_yearly_ltr_years` | `number` | `0` | no | Yearly LTR retention (years). 0 to disable. |
| `sql_db_alert_availability_enabled` | `bool` | `false` | no | Enable SQL Database Availability alert. |
| `sql_db_alert_app_cpu_percent_enabled` | `bool` | `false` | no | Enable SQL Database App CPU Percent alert. |
| `sql_db_alert_app_memory_percent_enabled` | `bool` | `false` | no | Enable SQL Database App Memory Percent alert. |
| `sql_db_alert_instance_cpu_percent_enabled` | `bool` | `false` | no | Enable SQL Database Instance CPU Percent alert. |
| `sql_db_alert_instance_memory_percent_enabled` | `bool` | `false` | no | Enable SQL Database Instance Memory Percent alert. |
| `sql_db_alert_storage_percent_enabled` | `bool` | `false` | no | Enable SQL Database Storage Percent alert. |
| `tags` | `map(string)` | `{}` | no | Tags applied to resources created by this template. |
| `storage_account_account_tier` | `string` | `"Standard"` | no | Storage Account tier (Standard or Premium). |
| `storage_account_account_replication_type` | `string` | `"LRS"` | no | Replication type (LRS, GRS, RAGRS, ZRS, GZRS, RAGZRS). |
| `storage_account_account_kind` | `string` | `"StorageV2"` | no | Account kind (Storage, StorageV2, BlobStorage). |
| `storage_account_access_tier` | `string` | `"Hot"` | no | Blob access tier (Hot or Cool). |
| `key_vault_sku_name` | `string` | `"standard"` | no | Key Vault SKU (standard or premium). |
| `key_vault_soft_delete_retention_days` | `number` | `90` | no | Soft delete retention in days. |
| `key_vault_purge_protection_enabled` | `bool` | `true` | no | Enable purge protection on the Key Vault. |
| `ai_search_sku` | `string` | `"basic"` | no | Search Service SKU (basic, standard, standard2, standard3, storage_optimized_l1/l2). |
| `ai_search_semantic_search_sku` | `string` | `"free"` | no | Semantic search SKU (free or standard). |
| `ai_search_replica_count` | `number` | `0` | no | Number of replicas (ignored for free SKU). |
| `ai_search_partition_count` | `number` | `1` | no | Number of partitions (not allowed for free SKU). |
| `ai_search_alert_search_latency_enabled` | `bool` | `false` | no | Enable AI Search SearchLatency alert. |
| `ai_search_alert_throttled_pct_enabled` | `bool` | `false` | no | Enable AI Search ThrottledSearchQueriesPercentage alert. |
| `ai_services_sku_name` | `string` | `"S0"` | no | AI Services SKU name. |
| `ai_services_soft_delete_retention_days` | `number` | `0` | no | Not applicable to AI Services (reserved for Key Vault parity). |
| `ai_services_purge_protection_enabled` | `bool` | `false` | no | Not applicable to AI Services (reserved for Key Vault parity). |
| `ai_services_model_deployment_names` | `list(string)` | n/a | yes | Azure OpenAI model deployment names used by AI Services alerts. |
| `ai_services_alert_availability_rate_enabled` | `bool` | `false` | no | Enable AzureOpenAIAvailabilityRate alert. |
| `key_vault_alert_availability_enabled` | `bool` | `false` | no | Enable Key Vault Availability alert. |
| `key_vault_alert_saturation_shoebox_enabled` | `bool` | `false` | no | Enable Key Vault SaturationShoebox alert. |
| `storage_alert_availability_enabled` | `bool` | `false` | no | Enable Storage Account Availability alert. |
| `storage_alert_success_server_latency_enabled` | `bool` | `false` | no | Enable Storage Account SuccessServerLatency alert. |
| `storage_alert_used_capacity_enabled` | `bool` | `false` | no | Enable Storage Account UsedCapacity alert. |
| `ai_services_alert_normalized_ttft_enabled` | `bool` | `false` | no | Enable AzureOpenAINormalizedTTFTInMS alert. |
| `ai_services_alert_ttlt_enabled` | `bool` | `false` | no | Enable AzureOpenAITTLTInMS alert. |
| `ai_services_alert_processed_tokens_enabled` | `bool` | `false` | no | Enable ProcessedInferenceTokens alert. |
| `ad_read_group_id` | `string` | `null` | no | Object ID of the Entra ID group to grant read-level roles. |
| `ad_full_group_id` | `string` | `null` | no | Object ID of the Entra ID group to grant full-level roles. |
| `sp_cicd_id` | `string` | `null` | no | Object ID of the CI/CD service principal. |
| `sp_app_id` | `string` | `null` | no | Object ID of the application service principal. |
| `action_group_emails` | `list(string)` | `[]` | no | List of email addresses for the action group. If empty, no action group is created. |

## 4. Outputs
| Name | Description |
|------|-------------|
| `location` | Azure region where resources are deployed. |
| `tags` | Tags applied to all resources created by this template. |
| `resource_group_id` | Resource Group ID. |
| `resource_group_name` | Resource Group name. |
| `private_endpoints_subnet_id` | Subnet ID used for Private Endpoints. |
| `log_analytics_workspace_id` | Log Analytics Workspace ID linked to Application Insights. |
| `log_analytics_workspace_name` | Log Analytics Workspace name. |
| `application_insights_id` | Application Insights ID. |
| `application_insights_name` | Application Insights name. |
| `application_insights_connection_string` | Application Insights connection string. |
| `application_insights_instrumentation_key` | Application Insights instrumentation key (classic ingestion). |
| `application_insights_app_id` | Application Insights App ID. |
| `sql_server_id` | SQL Server (logical server) ID. |
| `sql_server_name` | SQL Server name. |
| `sql_server_fqdn` | SQL Server fully qualified domain name. |
| `sql_server_principal_id` | SQL Server managed identity principal ID (if enabled). |
| `sql_server_private_endpoint_id` | SQL Server Private Endpoint ID (if created). |
| `sql_database_id` | SQL Database ID. |
| `sql_database_name` | SQL Database name. |
| `sql_database_identity_ids` | User Assigned Identity IDs attached to the SQL Database (if any). |
| `sql_database_auto_pause_delay_in_minutes` | SQL Database auto-pause delay in minutes (null if not set). |
| `key_vault_id` | Key Vault ID. |
| `key_vault_name` | Key Vault name. |
| `key_vault_uri` | Key Vault URI. |
| `key_vault_private_endpoint_id` | Key Vault Private Endpoint ID (if created). |
| `storage_account_id` | Storage Account ID. |
| `storage_account_name` | Storage Account name. |
| `storage_account_primary_blob_endpoint` | Storage Account primary Blob endpoint. |
| `ai_search_service_id` | AI Search Service ID. |
| `ai_search_service_name` | AI Search Service name. |
| `ai_search_service_managed_identity_principal_id` | AI Search Service managed identity principal ID (if enabled). |
| `ai_search_service_private_endpoint_id` | AI Search Service Private Endpoint ID (if created). |
| `ai_services_id` | AI Services ID. |
| `ai_services_name` | AI Services name. |
| `ai_services_managed_identity_principal_id` | AI Services managed identity principal ID (if enabled). |
| `ai_services_private_endpoint_id` | AI Services Private Endpoint ID (if created). |
| `ai_hub_id` | AI Hub ID. |
| `ai_hub_name` | AI Hub name. |
| `ai_hub_managed_identity_principal_id` | AI Hub managed identity principal ID (if enabled). |
| `ai_hub_private_endpoint_id` | AI Hub Private Endpoint ID (if created). |
| `ai_services_hub_connection_id` | AI Hub connection ID for AI Services (if created). |
| `ai_services_hub_connection_name` | AI Hub connection name for AI Services (if created). |
| `ai_search_hub_connection_id` | AI Hub connection ID for AI Search (if created). |
| `ai_search_hub_connection_name` | AI Hub connection name for AI Search (if created). |
| `api_key_hub_connection_id` | AI Hub API key connection ID (if created). |
| `api_key_hub_connection_name` | AI Hub API key connection name (if created). |
| `role_assignments_groups` | Map of role assignment IDs created for AD Groups, keyed by assignment alias. |
| `role_assignments_managed_identities` | Map of role assignment IDs created for Managed Identities, keyed by assignment alias. |
| `role_assignments_service_principals` | Map of role assignment IDs created for Service Principals, keyed by assignment alias. |
| `action_group_id` | Resource ID of the action group created by this template (if any). |
| `action_group_name` | Name of the action group created by this template (if any). |

## 5. Group Roles

### Read Group

| Role | Scope |
| --- | --- |
| BDSO Alert Operator | Resource Group |
| Reader | Application Insights |
| Reader | SQL Server |
| Reader | SQL Database |
| Reader | Key Vault |
| Reader | Storage Account |
| Storage Blob Data Reader | Storage Account |
| Reader | AI Search Service |
| Search Index Data Reader | AI Search Service |
| Reader | AI Services |
| Cognitive Services User | AI Services |
| Cognitive Services OpenAI User | AI Services |
| Reader | AI Hub |
| Reader | AI Project |

### Full Group

| Role | Scope |
| --- | --- |
| BDSO Alert Operator | Resource Group |
| Reader | Application Insights |
| Reader | SQL Server |
| Reader | SQL Database |
| Reader | Key Vault |
| Reader | Storage Account |
| Storage Blob Data Contributor | Storage Account |
| Reader | AI Search Service |
| Search Service Contributor | AI Search Service |
| Reader | AI Services |
| Cognitive Services User | AI Services |
| Cognitive Services OpenAI Contributor | AI Services |
| Reader | AI Hub |
| Reader | AI Project |
| BDSO Azure AI Developer | AI Project |

## 6. Managed Identity roles
The following roles are given to the resources Managed Identities.

| Managed Identity | Role | Resource |
| --- | --- | --- |
| AI Services MI | Search Index Data Contributor | AI Search Service |
| AI Services MI | Search Index Data Reader | AI Search Service |
| AI Services MI | Search Service Contributor | AI Search Service |
| AI Search MI | Cognitive Services Contributor | AI Services |
| AI Search MI | Cognitive Services OpenAI Contributor | AI Services |
| AI Search MI | Storage Blob Data Contributor | Storage Account |
| AI Project MI | Reader | Storage Account (Blob Private Endpoint) |
| AI Project MI | Reader | Storage Account (File Private Endpoint) |
| AI Hub MI | Contributor | Resource Group |

## 7. Service principal roles
The service principal roles are divided into two: CI/CD Sercice principals and App Service Principals.

### CI/CD Service Principal

| Role | Scope |
| --- | --- |
| Search Service Contributor | AI Search Service |
| Reader | AI Search Service |
| Storage Blob Data Contributor | Storage Account |
| Reader | Storage Account |

### App Service Principal

| Role | Scope |
| --- | --- |
| Search Index Data Contributor | AI Search Service |
| Reader | AI Search Service |
| Storage Blob Data Reader | Storage Account |
| Reader | Storage Account |
| Cognitive Services OpenAI User | AI Services |

## 8. Requirements

- Terraform: >= 1.12.1, < 2.0.0
- Provider azurerm: ~> 4.38 (with alias `azurerm.dns` configured)

### Used Modules

| Module | Description | Version |
| --- | --- | --- |
| `modules/region-abbreviations` | Region codes used for naming. | regabbr-v0.1.0 |
| `modules/application-insights` | Application Insights linked to LAW. | appi-v0.1.0 |
| `modules/sql-server` | Azure SQL logical server with PE. | sqlsrv-v0.1.0 |
| `modules/sql-database` | Azure SQL Database with backup config. | sqldb-v0.1.0 |
| `modules/sql-database-avail` | SQL Database Availability alert. | sqldb-avail-v0.1.0 |
| `modules/sql-database-cpu` | SQL Database App CPU Percent alert. | sqldb-cpu-v0.1.0 |
| `modules/sql-database-mem` | SQL Database App Memory Percent alert. | sqldb-mem-v0.1.0 |
| `modules/sql-database-sqlcpu` | SQL Database Instance CPU Percent alert. | sqldb-sqlcpu-v0.1.0 |
| `modules/sql-database-sqlmem` | SQL Database Instance Memory Percent alert. | sqldb-sqlmem-v0.1.0 |
| `modules/sql-database-stor` | SQL Database Storage Percent alert. | sqldb-stor-v0.1.0 |
| `modules/key-vault` | Azure Key Vault with RBAC + PE. | kv-v0.1.0 |
| `modules/key-vault-avail` | Key Vault Availability alert. | kv-avail-v0.1.0 |
| `modules/key-vault-sat` | Key Vault SaturationShoebox alert. | kv-sat-v0.1.0 |
| `modules/storage-account` | Storage Account with Blob/File PEs. | st-v0.1.0 |
| `modules/storage-account-avail` | Storage Account Availability alert. | st-avail-v0.1.0 |
| `modules/storage-account-sslat` | Storage Account SuccessServerLatency alert. | st-sslat-v0.1.0 |
| `modules/storage-account-used` | Storage Account UsedCapacity alert. | st-used-v0.1.0 |
| `modules/ai-search` | Azure AI Search with MI + PE. | srch-v0.1.0 |
| `modules/ai-search-lat` | AI Search SearchLatency alert. | srch-lat-v0.1.0 |
| `modules/ai-search-thrpct` | AI Search ThrottledSearchQueriesPercentage alert. | srch-thrpct-v0.1.0 |
| `modules/ai-services` | Azure AI Services with MI + PE. | ais-v0.1.0 |
| `modules/ai-services-avail` | AzureOpenAIAvailabilityRate alert. | ais-avail-v0.1.0 |
| `modules/ai-services-ttft` | AzureOpenAINormalizedTTFTInMS alert. | ais-ttft-v0.1.0 |
| `modules/ai-services-ttlt` | AzureOpenAITTLTInMS alert. | ais-ttlt-v0.1.0 |
| `modules/ai-services-tok` | ProcessedInferenceTokens alert. | ais-tok-v0.1.0 |
| `modules/ai-hub` | Azure AI Hub (system-assigned identity). | hub-v0.1.0 |
| `modules/ai-project` | Azure AI Project (system-assigned identity). | proj-v0.1.0 |
| `modules/ai-services-hub-connection` | AI Hub connection to AI Services. | aiscon-v0.1.0 |
| `modules/ai-search-hub-connection` | AI Hub connection to AI Search. | srchcon-v0.1.0 |
| `modules/api-key-hub-connection` | AI Hub API key connection. | apicon-v0.1.0 |
| `modules/action-group-map` | Azure Monitor Action Group via map input. | agm-v0.1.0 |


